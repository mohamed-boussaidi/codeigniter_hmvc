$(document).ready(function(){$("body").click(function(e){var child=$("td.child");child.removeClass("option");child.addClass("option");if(e.target.id==="dt-hide-show"){$(e.target).toggleClass("fa-plus-circle fa-minus-circle");}else{if(e.target.firstChild){if(e.target.firstChild.id==="dt-hide-show"){$(e.target.firstChild).toggleClass("fa-plus-circle fa-minus-circle");}}}});});(function($){$.fn.appTable=function(options){var displayLength=AppHelper.settings.displayLength||10;var defaults={source:"",columns:[],print:[],excel:[],pdf:[],exportationTitle:AppHelper.language.exportationTitle,order:[[0,"asc"]],hideTools:false,displayLength:displayLength,dateRangeType:"",checkBoxes:[],radioButtons:[],filterDropdown:[],filterParams:{datatable:true},summation:"",onDeleteSuccess:function(){},onInitComplete:function(){},customLanguage:{printButtonToolTip:AppHelper.language.printButtonToolTip,today:AppHelper.language.today,yesterday:AppHelper.language.yesterday,tomorrow:AppHelper.language.tomorrow},footerCallback:function(row,data,start,end,display){},rowCallback:function(nRow,aData,iDisplayIndex,iDisplayIndexFull){},fnDrawCallback:function(oSettings){}};var thisTable=$(this);if(!thisTable.is("table")){console.log("Element must have to be a table",this);return false;}var settings=$.extend({},defaults,options);settings.columns.unshift({title:"","class":"w30 text-center control"});if(settings.reload){thisTable.dataTable().fnReloadAjax(settings.filterParams);return false;}if(settings.newData){var dataTable=thisTable.dataTable();if(settings.dataId){var post_id=thisTable.find("[data-post-id='"+settings.dataId+"']");if(post_id.length){dataTable.fnDeleteRow(post_id.closest("tr"));}else{var index_id=$(this).find("[data-index-id='"+settings.dataId+"']");if(index_id.length){thisTable.fnDeleteRow(index_id.closest("tr"));}}}thisTable.fnAddRow(settings.newData);return false;}settings._visible_columns=[];$.each(settings.columns,function(index,column){if(column.visible!==false){settings._visible_columns.push(index);}});settings._firstDayOfWeek=AppHelper.settings.firstDayOfWeek||0;settings._inputDateFormat="YYYY-MM-DD";var getWeekRange=function(date){if(!date){date=moment().format(settings._inputDateFormat);}var dayOfWeek=moment(date).format("E");var diff=dayOfWeek-AppHelper.settings.firstDayOfWeek;var range={};if(diff<7){range.firstDateOfWeek=moment(date).subtract(diff,"days").format("YYYY-MM-DD");}else{range.firstDateOfWeek=moment(date).format("YYYY-MM-DD");}if(diff<0){range.firstDateOfWeek=moment(range.firstDateOfWeek).subtract(7,"days").format("YYYY-MM-DD");}range.lastDateOfWeek=moment(range.firstDateOfWeek).add(6,"days").format("YYYY-MM-DD");return range;};var prepareDefaultDateRangeFilterParams=function(){if(settings.dateRangeType==="daily"){settings.filterParams.start_date=moment().format(settings._inputDateFormat);settings.filterParams.end_date=settings.filterParams.start_date;}else{if(settings.dateRangeType==="monthly"){var daysInMonth=moment().daysInMonth();var yearMonth=moment().format("YYYY-MM");settings.filterParams.start_date=yearMonth+"-01";settings.filterParams.end_date=yearMonth+"-"+daysInMonth;}else{if(settings.dateRangeType==="yearly"){var year=moment().format("YYYY");settings.filterParams.start_date=year+"-01-01";settings.filterParams.end_date=year+"-12-31";}else{if(settings.dateRangeType==="weekly"){var range=getWeekRange();settings.filterParams.start_date=range.firstDateOfWeek;settings.filterParams.end_date=range.lastDateOfWeek;}}}}};var prepareDefaultCheckBoxFilterParams=function(){$.each(settings.checkBoxes,function(index,option){if(!("name" in settings.filterParams)){settings.filterParams[name]=[];}if(option.isChecked){settings.filterParams[name].push(option.value);}});};var prepareDefaultRadioFilterParams=function(){$.each(settings.radioButtons,function(index,option){if(option.isChecked){settings.filterParams[option.name]=option.value;}});};prepareDefaultDateRangeFilterParams();prepareDefaultCheckBoxFilterParams();prepareDefaultRadioFilterParams();var exportationButtons={buttons:[]};if(settings.pdf.length){exportationButtons.buttons.push({extend:"pdfHtml5",text:AppHelper.language.exportButtonPdf,className:"DTTT_button",filename:replaceAll(" ","_",settings.exportationTitle),title:settings.exportationTitle,exportOptions:{columns:settings.pdf},customize:function(doc){doc.content[1].table.widths=new Array(doc.content[1].table.body[0].length+1).join("*").split("");doc.styles.tableHeader.alignment="left";doc.styles.tableHeader.bold=true;doc.footer=(function(page,pages){return{columns:[{alignment:"center",text:[{text:page.toString()}," / ",{text:pages.toString()}]}],margin:[10,0]};});}});}if(settings.print.length){exportationButtons.buttons.push({extend:"print",text:AppHelper.language.exportButtonPrint,className:"DTTT_button",exportOptions:{columns:settings.print},title:settings.exportationTitle,customize:function(win){$(win.document.body).find("h1").css("text-align","center");$(win.document.body).find("h1").css("margin-top","30px");$(win.document.body).find("h1").css("margin-bottom","30px");$(win.document.body).css("font-size","10pt");$(win.document.body).find("table").addClass("compact");}});}if(settings.excel.length){exportationButtons.buttons.push({extend:"excelHtml5",text:AppHelper.language.exportButtonExcel,className:"DTTT_button",filename:replaceAll(" ","_",settings.exportationTitle),title:settings.exportationTitle,exportOptions:{columns:settings.excel}});}var datatableOptions={ajax:{url:settings.source,type:"POST",data:settings.filterParams},responsive:{details:{type:"column"}},buttons:exportationButtons,columnDefs:[{className:"control",orderable:false,targets:0}],lengthMenu:[[10,25,50,-1],[10,25,50,AppHelper.language.all]],columns:settings.columns,bProcessing:true,iDisplayLength:settings.displayLength,bAutoWidth:false,bSortClasses:false,order:settings.order,fnInitComplete:function(){settings.onInitComplete(this);},language:{lengthMenu:AppHelper.language.lengthMenu,zeroRecords:AppHelper.language.zeroRecords,search:AppHelper.language.search,searchPlaceholder:AppHelper.language.searchPlaceholder,sProcessing:"<div class='table-loader'><span class='loading'></span></div>",oPaginate:{sPrevious:"<i class='fa fa-angle-double-left'></i>",sNext:"<i class='fa fa-angle-double-right'></i>"}},sDom:"",footerCallback:function(row,data,start,end,display){var thisTable=this;if(settings.summation){var pageInfo=thisTable.api().page.info();if(pageInfo.recordsTotal){$(this).find("tfoot").show();}else{$(thisTable).find("tfoot").hide();return false;}$.each(settings.summation,function(index,option){var pageTotal=calculateDatatableTotal(thisTable,option,true);pageTotal=getDatatableFormattedTotal(pageTotal,option);$(thisTable).find("[data-current-page="+option.column+"]").html(pageTotal);if(pageInfo.pages>1){$(thisTable).find("[data-section='all_pages']").show();var total=calculateDatatableTotal(thisTable,option);total=getDatatableFormattedTotal(total,option);$(thisTable).find("[data-all-page="+option.column+"]").html(total);}else{$(thisTable).find("[data-section='all_pages']").hide();}});}settings.footerCallback(row,data,start,end,display,thisTable);},fnRowCallback:function(nRow,aData,iDisplayIndex,iDisplayIndexFull){settings.rowCallback(nRow,aData,iDisplayIndex,iDisplayIndexFull);},fnDrawCallback:function(oSettings){if(settings.hideTools===true){$(oSettings.nTHead).hide();}var exportButtons=$(".DTTT_button");exportButtons.removeClass("dt-button");exportButtons.removeClass("buttons-copy");exportButtons.removeClass("buttons-html5");exportButtons.removeClass("buttons-excel");exportButtons.removeClass("buttons-pdf");exportButtons.css("margin","3px 0");$(".dataTables_wrapper").find(".btn").css("margin","3px 0");$(".dt-buttons").css("float","right");settings.fnDrawCallback(oSettings);}};if(!settings.hideTools){datatableOptions.sDom="<'datatable-tools'<'col-md-3'l><'col-md-9 custom-toolbar'fB>r>t<'datatable-tools clearfix'<'col-md-3'i><'col-md-9'p>>";}var oTable=thisTable.dataTable(datatableOptions),thisTableWrapper=thisTable.closest(".dataTables_wrapper");thisTableWrapper.find("select").select2({minimumResultsForSearch:-1});dt_html_filters(thisTable,settings,options,thisTableWrapper,prepareDefaultDateRangeFilterParams,getWeekRange);function deleteElement(e){appLoader.show();var $target=$(e.currentTarget),url=$target.attr("data-action-url"),id=$target.attr("data-id");$.ajax({url:url,type:"POST",dataType:"json",data:{id:id},success:function(result){if(result.success){var tr=$target.closest("tr"),table=thisTable.DataTable();oTable.fnDeleteRow(table.row(tr).index());appAlert.success(result.message,{duration:10000});settings.onDeleteSuccess(result);}else{appAlert.error(result.message);}appLoader.hide();}});}var deleteHandler=function(e){swal({title:AppHelper.language.delete_box_title,text:AppHelper.language.delete_box_text+"\n"+AppHelper.language.delete_box_timer,type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:AppHelper.language.delete_box_confirm,cancelButtonText:AppHelper.language.delete_box_cancel,closeOnConfirm:true,timer:5000},function(confirm){if(confirm){deleteElement(e);}appAlert.warning(AppHelper.language.delete_box_canceled,{duration:5000});swal.close();});};window.InstanceCollection=window.InstanceCollection||{};window.InstanceCollection["#"+this.id]=settings;$("body").find(thisTable).on("click","[data-action=delete]",deleteHandler);$.fn.dataTableExt.oApi.getSettings=function(oSettings){return oSettings;};$.fn.dataTableExt.oApi.fnReloadAjax=function(oSettings,filterParams){this.fnClearTable();this.oApi._fnProcessingDisplay(oSettings,true);var that=this;$.ajax({url:oSettings.ajax.url,type:"POST",dataType:"json",data:filterParams,success:function(json){for(var i=0;i<json.data.length;i++){that.oApi._fnAddData(oSettings,json.data[i]);}oSettings.aiDisplay=oSettings.aiDisplayMaster.slice();that.fnDraw();that.oApi._fnProcessingDisplay(oSettings,false);}});};$.fn.dataTableExt.oApi.fnAddRow=function(oSettings,data){this.oApi._fnAddData(oSettings,data);this.fnDraw();};};})(jQuery);