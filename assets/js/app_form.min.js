(function($){$.fn.appForm=function(options){var defaults={ajaxSubmit:true,isModal:true,dataType:"json",onModalClose:function(){},onSuccess:function(){},onError:function(){return true;},onSubmit:function(){},onAjaxSuccess:function(){},beforeAjaxSubmit:function(data,self,options){}};var settings=$.extend({},defaults,options);this.each(function(){if(settings.ajaxSubmit){validateForm($(this),function(form){settings.onSubmit();if(settings.isModal){maskModal($("#ajaxModalContent").find(".modal-body"));}$(form).ajaxSubmit({dataType:settings.dataType,beforeSubmit:function(data,self,options){settings.beforeAjaxSubmit(data,self,options);},success:function(result){settings.onAjaxSuccess(result);if(result.success){settings.onSuccess(result);if(settings.isModal){closeAjaxModal(true);}}else{if(settings.onError(result)){if(settings.isModal){unmaskModal();if(result.message){appAlert.error(result.message,{container:".modal-body",animate:false});}}else{if(result.message){appAlert.error(result.message);}}}}}});});}else{validateForm($(this));}});function validateForm(form,customSubmit){$.validator.addMethod("greaterThanOrEqual",function(value,element,params){var paramsVal=params;if(params&&(params.indexOf("#")===0||params.indexOf(".")===0)){paramsVal=$(params).val();}if(!/Invalid|NaN/.test(new Date(value))){return new Date(value)>=new Date(paramsVal);}return isNaN(value)&&isNaN(paramsVal)||(Number(value)>=Number(paramsVal));},"Must be greater than {0}.");$.validator.addMethod("formattedDate",function(date,element){date=replaceAll("/","-",date);date=replaceAll(".","-",date);var format=AppHelper.settings.dateFormat.toUpperCase();format=replaceAll("/","-",format);format=replaceAll(".","-",format);return moment(date,format).isValid();},"Please enter a valid date.");$(form).validate({submitHandler:function(form){if(customSubmit){customSubmit(form);}else{return true;}},highlight:function(element){$(element).closest(".form-group").addClass("has-error");},unhighlight:function(element){$(element).closest(".form-group").removeClass("has-error");},errorElement:"span",errorClass:"help-block",ignore:":hidden:not(.validate-hidden)",errorPlacement:function(error,element){if(element.parent(".input-group").length){error.insertAfter(element.parent());}else{error.insertAfter(element);}}});$(".validate-hidden").click(function(){$(this).closest(".form-group").removeClass("has-error").find(".help-block").hide();});}function maskModal($maskTarget){var padding=$maskTarget.height()-80;if(padding>0){padding=Math.floor(padding/2);}$maskTarget.append("<div class='modal-mask'><div class='circle-loader'></div></div>");var height=$maskTarget.height();var $slimScrollDiv=$maskTarget.closest(".modal-content").find(".slimScrollDiv");if($slimScrollDiv.length&&$slimScrollDiv.find(".modal-body").length){height=20000;$slimScrollDiv.removeClass("slimScrollDiv").addClass("slimScrollDiv-deleted");$maskTarget.closest(".modal-content").find(".slimScrollBar").css({"z-index":"-1"});}$(".modal-mask").css({width:$maskTarget.width()+30+"px",height:height+"px","padding-top":padding+"px"});$maskTarget.closest(".modal-dialog").find('[type="submit"]').attr("disabled","disabled");}function unmaskModal(){var $maskTarget=$(".modal-body");$maskTarget.closest(".modal-dialog").find('[type="submit"]').removeAttr("disabled");$maskTarget.closest(".modal-content").find(".slimScrollDiv-deleted").removeClass("slimScrollDiv-deleted").addClass("slimScrollDiv");$maskTarget.closest(".modal-content").find(".slimScrollBar").css({"z-index":"auto"});$(".modal-mask").remove();}function closeAjaxModal(success){if(success){$(".modal-mask").html("<div class='circle-done'><i class='fa fa-check'></i></div>");setTimeout(function(){$(".modal-mask").find(".circle-done").addClass("ok");},30);}setTimeout(function(){$(".modal-mask").remove();$("#ajaxModal").modal("toggle");settings.onModalClose();},1000);}};})(jQuery);